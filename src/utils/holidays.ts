import { getDay } from 'date-fns';

interface HolidayMap {
    [dateStr: string]: string;
}

// 2024~2030년 음력 국경일(설날, 부처님오신날, 추석) 및 공휴일 데이터
const LUNAR_HOLIDAYS: HolidayMap = {
    // 2024
    '2024-02-09': '설날 연휴', '2024-02-10': '설날', '2024-02-11': '설날 연휴',
    '2024-05-15': '부처님오신날',
    '2024-09-16': '추석 연휴', '2024-09-17': '추석', '2024-09-18': '추석 연휴',
    // 2025
    '2025-01-28': '설날 연휴', '2025-01-29': '설날', '2025-01-30': '설날 연휴',
    '2025-05-05': '부처님오신날', // 어린이날과 겹침
    '2025-10-05': '추석 연휴', '2025-10-06': '추석', '2025-10-07': '추석 연휴',
    // 2026
    '2026-02-16': '설날 연휴', '2026-02-17': '설날', '2026-02-18': '설날 연휴',
    '2026-05-24': '부처님오신날',
    '2026-09-24': '추석 연휴', '2026-09-25': '추석', '2026-09-26': '추석 연휴',
    // 2027
    '2027-02-06': '설날 연휴', '2027-02-07': '설날', '2027-02-08': '설날 연휴',
    '2027-05-13': '부처님오신날',
    '2027-09-14': '추석 연휴', '2027-09-15': '추석', '2027-09-16': '추석 연휴',
    // 2028
    '2028-01-26': '설날 연휴', '2028-01-27': '설날', '2028-01-28': '설날 연휴',
    '2028-05-02': '부처님오신날',
    '2028-10-02': '추석 연휴', '2028-10-03': '추석', '2028-10-04': '추석 연휴',
    // 2029
    '2029-02-12': '설날 연휴', '2029-02-13': '설날', '2029-02-14': '설날 연휴',
    '2029-05-20': '부처님오신날',
    '2029-09-21': '추석 연휴', '2029-09-22': '추석', '2029-09-23': '추석 연휴',
    // 2030
    '2030-02-02': '설날 연휴', '2030-02-03': '설날', '2030-02-04': '설날 연휴',
    '2030-05-09': '부처님오신날',
    '2030-09-11': '추석 연휴', '2030-09-12': '추석', '2030-09-13': '추석 연휴',
};

// 지정된 날짜가 휴일인지 여부, 휴일 이름을 반환
export function getKoreanHoliday(date: Date): { isHoliday: boolean, name: string | null } {
    const year = date.getFullYear();
    const month = date.getMonth() + 1;
    const day = date.getDate();
    const dayOfWeek = getDay(date); // 0: Sun, 1: Mon, ..., 6: Sat

    // YYYY-MM-DD 포맷
    const dateStr = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
    const mmdd = `${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;

    let name = null;

    // 1. 고정 국경일 및 태양력 붉은날
    const solarHols: Record<string, string> = {
        '01-01': '신정',
        '03-01': '삼일절',
        '05-05': '어린이날',
        '06-06': '현충일',
        '08-15': '광복절',
        '10-03': '개천절',
        '10-09': '한글날',
        '12-25': '성탄절',
    };

    if (solarHols[mmdd]) name = solarHols[mmdd];

    // 요청사항: 2026년부터 제헌절(7.17)을 휴일로 포기
    if (year >= 2026 && mmdd === '07-17') name = name ? `${name}/제헌절` : '제헌절';

    // 2. 음력 명절 매핑 (2024~2030)
    if (LUNAR_HOLIDAYS[dateStr]) {
        name = name ? `${name}/${LUNAR_HOLIDAYS[dateStr]}` : LUNAR_HOLIDAYS[dateStr];
    }

    // 3. 주요 대체공휴일 매핑 (2024~2030)
    const subHolidays: Record<string, string> = {
        '2024-02-12': '대체공휴일',
        '2024-05-06': '대체공휴일',
        '2025-03-03': '대체공휴일',
        '2025-05-06': '대체공휴일',
        '2025-10-08': '대체공휴일',
        '2026-03-02': '대체공휴일',
        '2026-05-25': '대체공휴일',
        '2026-08-17': '대체공휴일',
        '2026-10-05': '대체공휴일',
        '2027-02-09': '대체공휴일',
        '2027-08-16': '대체공휴일',
        '2027-10-04': '대체공휴일',
        '2027-10-11': '대체공휴일',
        '2027-12-27': '대체공휴일',
        '2028-10-05': '대체공휴일',
        '2029-05-21': '대체공휴일',
        '2029-09-24': '대체공휴일',
        '2030-02-05': '대체공휴일',
        '2030-05-06': '대체공휴일',
    };

    if (subHolidays[dateStr]) {
        name = name ? `${name}(${subHolidays[dateStr]})` : subHolidays[dateStr];
    }

    // 이름이 있거나 일요일(0)이면 빨간날
    const isHoliday = name !== null || dayOfWeek === 0;

    return { isHoliday, name };
}
